{% extends "layout.html" %}
{% block title %}
Imports
{% endblock %}
{% block content %}
<script>
    $(document).ready( function () {
        $('#imports').DataTable();
    } );
</script>
<div class="container-fluid mt-3">
    {% if not context.isPost%}
    <h3>Import Data</h3>
    <form action="{{ url_for('show_imports') }}" method="POST">
        <select name='source' class="form-select form-select-md mb-3" aria-label=".form-select-lg example">
            <option selected>Source</option>
            <option value="jita">Jita IV - Moon 4 - Caldari Navy Assembly Plant</option>
            {% for key, val in context.structures.items() %}
            <option value="{{key}}">{{val}}</option>
            {% endfor %}
        </select>
        <select name='destination' class="form-select form-select-md mb-3" aria-label=".form-select-lg example">
            <option selected>Desination</option>
            <option value="jita">Jita IV - Moon 4 - Caldari Navy Assembly Plant</option>
            {% for key, val in context.structures.items() %}
            <option value="{{key}}">{{val}}</option>
            {% endfor %}
        </select>
        
        <div class="col-12">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="updatePrices" id="updatePrices">
              <label class="form-check-label" for="updatePrices">
                Update Prices
              </label>
            </div>
        </div>

        <button type="submit" class="btn btn-primary">Submit</button>
    </form>
    {% else %}
    <table id="imports" class="table table-bordered table-striped">
        <thead class="thead-light">
            <tr>
                <th>Item</th>
                <th>Source Price</th>
                <th>Destination Price</th>
                <th>Price Difference</th>
                <th>M3</th>
                <th>Shipping Price</th>
                <th>Profit before Market Fees</th>
            </tr>
        </thead>
        <tbody>
        {% for key, value in context.imports.items() %}
            {% if value.sourcePrice - value.destoPrice > 0 %}
            <tr class="table-warning">
            {% else %}
            <tr>
            {% endif %}
                <td>{{value.itemName}}</td>
                <td>{{value.sourcePrice | numberFormat}}</td>
                <td>{{value.destoPrice | numberFormat}}</td>
                <td>{{(value.destoPrice - value.sourcePrice) | numberFormat}}</td>
                <td>{{value.volume | numberFormat}}</td>
                <td>{{((value.volume * context.pricePerM3) + (value.sourcePrice * context.collateralPercentage)) | numberFormat}}</td>
                <td>{{((value.destoPrice - value.sourcePrice) - ((value.volume * context.pricePerM3) + (value.sourcePrice * context.collateralPercentage))) | numberFormat}}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    {% endif %}
</div>

{% endblock %}